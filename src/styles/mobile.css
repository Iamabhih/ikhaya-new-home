/*
 * Mobile-specific optimizations with browser compatibility
 * ========================================================
 * Note: Touch target, body, and box-sizing base styles are in base.css
 * This file contains mobile breakpoint-specific refinements
 */

@media (max-width: 768px) {
  /*
   * Touch Target Enhancement (opt-in class)
   * Use .touch-target class for elements needing 44px minimum
   * Don't apply globally to avoid breaking UI layouts
   */
  .touch-target,
  [data-clickable] {
    min-height: 44px;
    min-width: 44px;
    touch-action: manipulation;
  }

  /* CRITICAL: Prevent zoom on input focus - use exactly 16px for iOS */
  input[type="text"],
  input[type="email"],
  input[type="password"],
  input[type="search"],
  input[type="tel"],
  input[type="url"],
  input[type="number"],
  textarea,
  select {
    font-size: 16px !important;
    -webkit-appearance: none;
    background-color: transparent;
  }

  /*
   * Tap Highlight & User Selection Control
   * Uses CSS variables for brand consistency
   */

  /* Styled buttons with custom hover states can remove tap highlight */
  button.custom-styled,
  .custom-button {
    -webkit-tap-highlight-color: transparent;
  }

  /* Standard interactive elements get brand color tap feedback */
  button:not(.custom-styled):not([class*="ghost"]),
  a:not([class*="ghost"]) {
    -webkit-tap-highlight-color: hsl(var(--primary) / 0.2);
  }

  /* Selective user selection - only disable for interactive elements */
  button,
  [role="button"],
  .no-select {
    -webkit-touch-callout: none;
    -webkit-user-select: none;
    user-select: none;
  }

  /* Ensure text content remains selectable */
  input,
  textarea,
  [contenteditable] {
    -webkit-user-select: text;
    user-select: text;
  }

  /* Ensure proper mobile viewport handling */
  #root {
    min-height: 100vh;
    min-height: 100dvh; /* Dynamic viewport height for mobile browsers */
    position: relative;
    width: 100%;
    overflow-x: hidden;
  }

  /* Android browser specific optimizations */
  img {
    -webkit-backface-visibility: hidden;
    backface-visibility: hidden;
  }
}

/* Chrome mobile specific fixes */
@media screen and (-webkit-min-device-pixel-ratio: 0) and (max-width: 768px) {
  select {
    background-image: none;
  }

  input[type="search"] {
    -webkit-appearance: textfield;
  }
}

/* Small screen specific (supplements responsive.css) */
@media screen and (max-width: 768px) {
  html,
  body {
    overflow-x: hidden;
    width: 100%;
  }

  /* Ensure main content scrolls properly */
  main {
    overflow-y: visible;
    overflow-x: hidden;
  }

  /* Fix for fixed header content offset on mobile
     Header heights: h-12 (3rem) default, xs:h-14 (3.5rem), sm:h-16 (4rem) */
  .page-content {
    padding-top: 3rem;
  }

  /* Ensure cards and containers don't cause horizontal overflow */
  .card,
  [class*="container"] {
    max-width: 100%;
  }
}

/* Responsive page-content offset at xs breakpoint */
@media (min-width: 375px) and (max-width: 639px) {
  .page-content {
    padding-top: 3.5rem; /* Match xs header h-14 */
  }
}

/* Fix iOS Safari address bar issues */
@supports (-webkit-touch-callout: none) {
  /* iOS only */
  .full-height {
    min-height: -webkit-fill-available;
  }

  /* Prevent iOS rubber-banding causing layout glitches */
  html {
    overflow: hidden;
    height: 100%;
  }

  body {
    overflow: auto;
    height: 100%;
    -webkit-overflow-scrolling: touch;
  }

  /* Ensure scrolling works in standalone PWA mode */
  @media (display-mode: standalone) {
    body {
      overflow-y: auto;
      -webkit-overflow-scrolling: touch;
    }

    #root {
      overflow-y: auto;
      height: 100%;
    }
  }
}
